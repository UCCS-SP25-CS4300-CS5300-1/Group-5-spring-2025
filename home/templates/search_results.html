<!-- inherit from base.html-->
{% extends "base_template.html" %}
{% load static %}


<!-- Replace block content in base_template.html BEFORE I MESS EVERYTHING UP-->
{% block content %}

<div class="results-container">
    <div class="campsite-list">

{% if campsites %}
    <h2 class="search-results">Results For {{ query }}</h2>
    <ul>
        {% for site in campsites %}
            <li class="campsite-items">
                <a href="{% url 'facility_detail' site.FacilityID %}?q={{ request.GET.q }}" style="color: #ff930e">
                    <strong>{{ site.FacilityName }}</strong> - {{ site.FacilityTypeDescription }}
                </a>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>No results found.</p>
{% endif %}

</div>

 <!-- Display Map -->
 <div class="map-container">
    <div id="map"></div>
</div>
</div>

<!-- Leaflet.js CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
    #map {
        height: 450px;
        width: 100%;
        border-radius: 16px;
        margin-bottom: 20px;
    }
</style>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        var map = L.map('map').setView([39.5, -98.35], 5); // Default center (USA)

        // Add tile layer (OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Dynamically insert markers based on Django context
        var campsites = [
            {% for site in campsites %}
                {
                    name: "{{ site.FacilityName|escapejs }}",
                    lat: {{ site.FacilityLatitude|default:"null" }},
                    lon: {{ site.FacilityLongitude|default:"null" }},
                    type: "{{ site.FacilityTypeDescription|escapejs }}",
                    id: "{{ site.FacilityID }}"
                },
            {% endfor %}
        ];

        // Add markers to the map
        campsites.forEach(function (site) {
            if (site.lat && site.lon) {
                L.marker([site.lat, site.lon]).addTo(map)
                    .bindPopup(`<b>${site.name}</b><br>Type: ${site.type}<br>
                                <a href="/facility/${site.id}?q={{ request.GET.q }}">View Details</a>`);
            }
        });
    });
</script>


{% endblock %}
